!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function makeComment(b,a,x){var c;return b&&(c={b:b}),a&&((c=c||{}).a=a),x&&((c=c||{}).x=x),c}function extractComments(value,root){if(null!==value&&"object"==typeof value){var comments=common.getComment(value);comments&&common.removeComment(value);var i,length,any,res;if("[object Array]"===Object.prototype.toString.apply(value)){for(res={a:[]},i=0,length=value.length;i<length;i++)saveComment(res.a,i,comments.a[i],extractComments(value[i]))&&(any=!0);!any&&comments.e&&(res.e=makeComment(comments.e[0],comments.e[1]),any=!0)}else{res={s:{}};var keys,currentKeys=Object.keys(value);for(comments&&comments.o?(keys=[],comments.o.concat(currentKeys).forEach(function(key){Object.prototype.hasOwnProperty.call(value,key)&&keys.indexOf(key)<0&&keys.push(key)})):keys=currentKeys,res.o=keys,i=0,length=keys.length;i<length;i++){var key=keys[i];saveComment(res.s,key,comments.c[key],extractComments(value[key]))&&(any=!0)}!any&&comments.e&&(res.e=makeComment(comments.e[0],comments.e[1]),any=!0)}return root&&comments&&comments.r&&(res.r=makeComment(comments.r[0],comments.r[1])),any?res:void 0}}function mergeStr(){var res="";return[].forEach.call(arguments,function(c){c&&""!==c.trim()&&(res&&(res+="; "),res+=c.trim())}),res}function mergeComments(comments,value){var dropped=[];if(merge(comments,value,dropped,[]),dropped.length>0){var text=rootComment(value,null,1);text+="\n# Orphaned comments:\n",dropped.forEach(function(c){text+=("# "+c.path.join("/")+": "+mergeStr(c.b,c.a,c.e)).replace("\n","\\n ")+"\n"}),rootComment(value,text,1)}}function saveComment(res,key,item,col){var c=makeComment(item?item[0]:void 0,item?item[1]:void 0,col);return c&&(res[key]=c),c}function droppedComment(path,c){var res=makeComment(c.b,c.a);return res.path=path,res}function dropAll(comments,dropped,path){if(comments){var i,length;if(comments.a)for(i=0,length=comments.a.length;i<length;i++){var kpath=path.slice().concat([i]),c=comments.a[i];c&&(dropped.push(droppedComment(kpath,c)),dropAll(c.x,dropped,kpath))}else comments.o&&comments.o.forEach(function(key){var kpath=path.slice().concat([key]),c=comments.s[key];c&&(dropped.push(droppedComment(kpath,c)),dropAll(c.x,dropped,kpath))});comments.e&&dropped.push(droppedComment(path,comments.e))}}function merge(comments,value,dropped,path){if(comments){if(null===value||"object"!=typeof value)return void dropAll(comments,dropped,path);var i,length,setComments=common.createComment(value);if(0===path.length&&comments.r&&(setComments.r=[comments.r.b,comments.r.a]),"[object Array]"===Object.prototype.toString.apply(value)){for(setComments.a=[],i=0,length=(comments.a||[]).length;i<length;i++){var kpath=path.slice().concat([i]),c=comments.a[i];c&&(i<value.length?(setComments.a.push([c.b,c.a]),merge(c.x,value[i],dropped,kpath)):(dropped.push(droppedComment(kpath,c)),dropAll(c.x,dropped,kpath)))}0===i&&comments.e&&(setComments.e=[comments.e.b,comments.e.a])}else setComments.c={},setComments.o=[],(comments.o||[]).forEach(function(key){var kpath=path.slice().concat([key]),c=comments.s[key];Object.prototype.hasOwnProperty.call(value,key)?(setComments.o.push(key),c&&(setComments.c[key]=[c.b,c.a],merge(c.x,value[key],dropped,kpath))):c&&(dropped.push(droppedComment(kpath,c)),dropAll(c.x,dropped,kpath))}),comments.e&&(setComments.e=[comments.e.b,comments.e.a])}}function rootComment(value,setText,header){var comment=common.createComment(value,common.getComment(value));return comment.r||(comment.r=["",""]),(setText||""===setText)&&(comment.r[header]=common.forceComment(setText)),comment.r[header]||""}var common=require("./hjson-common");module.exports={extract:function(value){return extractComments(value,!0)},merge:mergeComments,header:function(value,setText){return rootComment(value,setText,0)},footer:function(value,setText){return rootComment(value,setText,1)}}},{"./hjson-common":2}],2:[function(require,module,exports){"use strict";function tryParseNumber(text,stopAtNext){function next(){return ch=text.charAt(at),at++,ch}var number,ch,string="",leadingZeros=0,testLeading=!0,at=0;for(next(),"-"===ch&&(string="-",next());ch>="0"&&ch<="9";)testLeading&&("0"==ch?leadingZeros++:testLeading=!1),string+=ch,next();if(testLeading&&leadingZeros--,"."===ch)for(string+=".";next()&&ch>="0"&&ch<="9";)string+=ch;if("e"===ch||"E"===ch)for(string+=ch,next(),"-"!==ch&&"+"!==ch||(string+=ch,next());ch>="0"&&ch<="9";)string+=ch,next();for(;ch&&ch<=" ";)next();return stopAtNext&&(","!==ch&&"}"!==ch&&"]"!==ch&&"#"!==ch&&("/"!==ch||"/"!==text[at]&&"*"!==text[at])||(ch=0)),number=+string,ch||leadingZeros||!isFinite(number)?void 0:number}function createComment(value,comment){return Object.defineProperty&&Object.defineProperty(value,"__COMMENTS__",{enumerable:!1,writable:!0}),value.__COMMENTS__=comment||{}}function removeComment(value){Object.defineProperty(value,"__COMMENTS__",{value:void 0})}function getComment(value){return value.__COMMENTS__}function forceComment(text){if(!text)return"";var str,i,j,len,a=text.split("\n");for(j=0;j<a.length;j++)for(str=a[j],len=str.length,i=0;i<len;i++){var c=str[i];if("#"===c)break;if("/"===c&&("/"===str[i+1]||"*"===str[i+1])){"*"===str[i+1]&&(j=a.length);break}if(c>" "){a[j]="# "+str;break}}return a.join("\n")}var os=require("os");module.exports={EOL:os.EOL||"\n",tryParseNumber:tryParseNumber,createComment:createComment,removeComment:removeComment,getComment:getComment,forceComment:forceComment}},{os:8}],3:[function(require,module,exports){"use strict";function loadDsf(col,type){function isFunction(f){return"[object Function]"==={}.toString.call(f)}if("[object Array]"!==Object.prototype.toString.apply(col)){if(col)throw new Error("dsf option must contain an array!");return nopDsf}if(0===col.length)return nopDsf;var dsf=[];return col.forEach(function(x){if(!x.name||!isFunction(x.parse)||!isFunction(x.stringify))throw new Error("extension does not match the DSF interface");dsf.push(function(){try{if("parse"==type)return x.parse.apply(null,arguments);if("stringify"==type){var res=x.stringify.apply(null,arguments);if(void 0!==res&&("string"!=typeof res||0===res.length||'"'===res[0]||[].some.call(res,function(c){return isInvalidDsfChar(c)})))throw new Error("value may not be empty, start with a quote or contain a punctuator character except colon: "+res);return res}throw new Error("Invalid type")}catch(e){throw new Error("DSF-"+x.name+" failed; "+e.message)}})}),runDsf.bind(null,dsf)}function runDsf(dsf,value){if(dsf)for(var i=0;i<dsf.length;i++){var res=dsf[i](value);if(void 0!==res)return res}}function nopDsf(value){}function isInvalidDsfChar(c){return"{"===c||"}"===c||"["===c||"]"===c||","===c}function math(opt){return{name:"math",parse:function(value){switch(value){case"+inf":case"inf":case"+Inf":case"Inf":return 1/0;case"-inf":case"-Inf":return-(1/0);case"nan":case"NaN":return NaN}},stringify:function(value){if("number"==typeof value)return 1/value===-(1/0)?"-0":value===1/0?"Inf":value===-(1/0)?"-Inf":isNaN(value)?"NaN":void 0}}}function hex(opt){var out=opt&&opt.out;return{name:"hex",parse:function(value){if(/^0x[0-9A-Fa-f]+$/.test(value))return parseInt(value,16)},stringify:function(value){if(out&&Number.isInteger(value))return"0x"+value.toString(16)}}}function date(opt){return{name:"date",parse:function(value){if(/^\d{4}-\d{2}-\d{2}$/.test(value)||/^\d{4}-\d{2}-\d{2}T\d{2}\:\d{2}\:\d{2}(?:.\d+)(?:Z|[+-]\d{2}:\d{2})$/.test(value)){var dt=Date.parse(value);if(!isNaN(dt))return new Date(dt)}},stringify:function(value){if("[object Date]"===Object.prototype.toString.call(value)){var dt=value.toISOString();return dt.indexOf("T00:00:00.000Z",dt.length-14)!==-1?dt.substr(0,10):dt}}}}require("./hjson-common");math.description="support for Inf/inf, -Inf/-inf, Nan/naN and -0",hex.description="parse hexadecimal numbers prefixed with 0x",date.description="support ISO dates",module.exports={loadDsf:loadDsf,std:{math:math,hex:hex,date:date}}},{"./hjson-common":2}],4:[function(require,module,exports){"use strict";module.exports=function($source,$opt){function resetAt(){at=0,ch=" "}function isPunctuatorChar(c){return"{"===c||"}"===c||"["===c||"]"===c||","===c||":"===c}function error(m){var i,col=0,line=1;for(i=at-1;i>0&&"\n"!==text[i];i--,col++);for(;i>0;i--)"\n"===text[i]&&line++;throw new Error(m+" at line "+line+","+col+" >>>"+text.substr(at-col,20)+" ...")}function next(){return ch=text.charAt(at),at++,ch}function peek(offs){return text.charAt(at+offs)}function string(){var string="";if('"'===ch)for(;next();){if('"'===ch)return next(),string;if("\\"===ch)if(next(),"u"===ch){for(var uffff=0,i=0;i<4;i++){next();var hex,c=ch.charCodeAt(0);ch>="0"&&ch<="9"?hex=c-48:ch>="a"&&ch<="f"?hex=c-97+10:ch>="A"&&ch<="F"?hex=c-65+10:error("Bad \\u char "+ch),uffff=16*uffff+hex}string+=String.fromCharCode(uffff)}else{if("string"!=typeof escapee[ch])break;string+=escapee[ch]}else string+=ch}error("Bad string")}function mlString(){function skipIndent(){for(var skip=indent;ch&&ch<=" "&&"\n"!==ch&&skip-- >0;)next()}for(var string="",triple=0,indent=0;;){var c=peek(-indent-5);if(!c||"\n"===c)break;indent++}for(;ch&&ch<=" "&&"\n"!==ch;)next();for("\n"===ch&&(next(),skipIndent());;){if(ch){if("'"===ch){if(triple++,next(),3===triple)return"\n"===string.slice(-1)&&(string=string.slice(0,-1)),string;continue}for(;triple>0;)string+="'",triple--}else error("Bad multiline string");"\n"===ch?(string+="\n",next(),skipIndent()):("\r"!==ch&&(string+=ch),next())}}function keyname(){if('"'===ch)return string();for(var name="",start=at,space=-1;;){if(":"===ch)return name?space>=0&&space!==name.length&&(at=start+space,error("Found whitespace in your key name (use quotes to include)")):error("Found ':' but no key name (for an empty key name use quotes)"),name;ch<=" "?ch?space<0&&(space=name.length):error("Found EOF while looking for a key name (check your syntax)"):isPunctuatorChar(ch)?error("Found '"+ch+"' where a key name was expected (check your syntax or use quotes if the key name includes {}[],: or whitespace)"):name+=ch,next()}}function white(){for(;ch;){for(;ch&&ch<=" ";)next();if("#"===ch||"/"===ch&&"/"===peek(0))for(;ch&&"\n"!==ch;)next();else{if("/"!==ch||"*"!==peek(0))break;for(next(),next();ch&&("*"!==ch||"/"!==peek(0));)next();ch&&(next(),next())}}}function tfnns(){var value=ch;for(isPunctuatorChar(ch)&&error("Found a punctuator character '"+ch+"' when expecting a quoteless string (check your syntax)");;){if(next(),3===value.length&&"'''"===value)return mlString();var isEol="\r"===ch||"\n"===ch||""===ch;if(isEol||","===ch||"}"===ch||"]"===ch||"#"===ch||"/"===ch&&("/"===peek(0)||"*"===peek(0))){var chf=value[0];switch(chf){case"f":if("false"===value.trim())return!1;break;case"n":if("null"===value.trim())return null;break;case"t":if("true"===value.trim())return!0;break;default:if("-"===chf||chf>="0"&&chf<="9"){var n=common.tryParseNumber(value);if(void 0!==n)return n}}if(isEol){value=value.trim();var dsfValue=runDsf(value);return void 0!==dsfValue?dsfValue:value}}value+=ch}}function getComment(cAt,first){var i;for(cAt--,i=at-2;i>cAt&&text[i]<=" "&&"\n"!==text[i];i--);"\n"===text[i]&&i--,"\r"===text[i]&&i--;var res=text.substr(cAt,i-cAt+1);for(i=0;i<res.length;i++)if(res[i]>" "){var j=res.indexOf("\n");if(j>=0){var c=[res.substr(0,j),res.substr(j+1)];return first&&0===c[0].trim().length&&c.shift(),c}return[res]}return[]}function errorClosingHint(value){function search(value,ch){var i,k,length,res;switch(typeof value){case"string":value.indexOf(ch)>=0&&(res=value);break;case"object":if("[object Array]"===Object.prototype.toString.apply(value))for(i=0,length=value.length;i<length;i++)res=search(value[i],ch)||res;else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(res=search(value[k],ch)||res)}return res}function report(ch){var possibleErr=search(value,ch);return possibleErr?"found '"+ch+"' in a string value, your mistake could be with:\n  > "+possibleErr+"\n  (unquoted strings contain everything up to the next line!)":""}return report("}")||report("]")}function array(){var comments,cAt,nextComment,array=[];try{if(keepComments&&(comments=common.createComment(array,{a:[]})),next(),cAt=at,white(),comments&&(nextComment=getComment(cAt,!0).join("\n")),"]"===ch)return next(),comments&&(comments.e=[nextComment]),array;for(;ch;){if(array.push(value()),cAt=at,white(),","===ch&&(next(),cAt=at,white()),comments){var c=getComment(cAt);comments.a.push([nextComment||"",c[0]||""]),nextComment=c[1]}if("]"===ch)return next(),comments&&(comments.a[comments.a.length-1][1]+=nextComment||""),array;white()}error("End of input while parsing an array (missing ']')")}catch(e){throw e.hint=e.hint||errorClosingHint(array),e}}function object(withoutBraces){var comments,cAt,nextComment,key="",object={};try{if(keepComments&&(comments=common.createComment(object,{c:{},o:[]})),withoutBraces?cAt=1:(next(),cAt=at),white(),comments&&(nextComment=getComment(cAt,!0).join("\n")),"}"===ch&&!withoutBraces)return comments&&(comments.e=[nextComment]),next(),object;for(;ch;){if(key=keyname(),white(),":"!==ch&&error("Expected ':' instead of '"+ch+"'"),next(),object[key]=value(),cAt=at,white(),","===ch&&(next(),cAt=at,white()),comments){var c=getComment(cAt);comments.c[key]=[nextComment||"",c[0]||""],nextComment=c[1],comments.o.push(key)}if("}"===ch&&!withoutBraces)return next(),comments&&(comments.c[key][1]+=nextComment||""),object;white()}if(withoutBraces)return object;error("End of input while parsing an object (missing '}')")}catch(e){throw e.hint=e.hint||errorClosingHint(object),e}}function value(){switch(white(),ch){case"{":return object();case"[":return array();case'"':return string();default:return tfnns()}}function checkTrailing(v,c){var cAt=at;if(white(),ch&&error("Syntax error, found trailing characters"),keepComments){var b=c.join("\n"),a=getComment(cAt).join("\n");if(a||b){var comments=common.createComment(v,common.getComment(v));comments.r=[b,a]}}return v}function rootValue(){white();var c=keepComments?getComment(1):null;switch(ch){case"{":return checkTrailing(object(),c);case"[":return checkTrailing(array(),c)}try{return checkTrailing(object(!0),c)}catch(e){resetAt();try{return checkTrailing(value(),c)}catch(e2){throw e}}}function hjsonParse(source,opt){if("string"!=typeof source)throw new Error("source is not a string");var dsfDef=null;return opt&&"object"==typeof opt&&(keepComments=opt.keepWsc,dsfDef=opt.dsf),runDsf=dsf.loadDsf(dsfDef,"parse"),text=source,resetAt(),rootValue()}var text,at,ch,keepComments,runDsf,common=require("./hjson-common"),dsf=require("./hjson-dsf"),escapee={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};return hjsonParse($source,$opt)}},{"./hjson-common":2,"./hjson-dsf":3}],5:[function(require,module,exports){"use strict";module.exports=function($value,$opt){function wrap(tk,v){return tk[0]+v+tk[1]}function quoteReplace(string){return string.replace(needsEscape,function(a){var c=meta[a];return"string"==typeof c?wrap(token.esc,c):wrap(token.uni,("0000"+a.charCodeAt(0).toString(16)).slice(-4))})}function quote(string,gap,hasComment,isRootObject){return string?(needsQuotes.lastIndex=0,startsWithKeyword.lastIndex=0,quoteAlways||hasComment||needsQuotes.test(string)||void 0!==common.tryParseNumber(string,!0)||startsWithKeyword.test(string)?(needsEscape.lastIndex=0,needsEscapeML.lastIndex=0,needsEscape.test(string)?needsEscapeML.test(string)||isRootObject?wrap(token.qstr,quoteReplace(string)):mlString(string,gap):wrap(token.qstr,string)):wrap(token.str,string)):wrap(token.qstr,"")}function mlString(string,gap){var i,a=string.replace(/\r/g,"").split("\n");if(gap+=indent,1===a.length)return wrap(token.mstr,a[0]);var res=eol+gap+token.mstr[0];for(i=0;i<a.length;i++)res+=eol,a[i]&&(res+=gap+a[i]);return res+eol+gap+token.mstr[1]}function quoteKey(name){return name?needsEscapeName.test(name)?(needsEscape.lastIndex=0,wrap(token.qkey,needsEscape.test(name)?quoteReplace(name):name)):wrap(token.key,name):'""'}function str(value,hasComment,noIndent,isRootObject){function startsWithNL(str){return str&&"\n"===str["\r"===str[0]?1:0]}function commentOnThisLine(str){return str&&!startsWithNL(str)}function makeComment(str,prefix,trim){if(!str)return"";str=common.forceComment(str);var i,len=str.length;for(i=0;i<len&&str[i]<=" ";i++);return trim&&i>0&&(str=str.substr(i)),i<len?prefix+wrap(token.rem,str):str}var dsfValue=runDsf(value);if(void 0!==dsfValue)return wrap(token.dsf,dsfValue);switch(typeof value){case"string":return quote(value,gap,hasComment,isRootObject);case"number":return isFinite(value)?wrap(token.num,String(value)):wrap(token.lit,"null");case"boolean":return wrap(token.lit,String(value));case"object":if(!value)return wrap(token.lit,"null");var comments;keepComments&&(comments=common.getComment(value));var isArray="[object Array]"===Object.prototype.toString.apply(value),mind=gap;gap+=indent;var i,length,k,v,c,ca,eolMind=eol+mind,eolGap=eol+gap,prefix=noIndent||bracesSameLine?"":eolMind,partial=[];if(isArray){for(i=0,length=value.length;i<length;i++)comments&&(c=comments.a[i]||[],ca=commentOnThisLine(c[1]),partial.push(makeComment(c[0],"\n")+eolGap)),partial.push(str(value[i],!!comments&&ca,!0)||wrap(token.lit,"null")),comments&&c[1]&&partial.push(makeComment(c[1],ca?" ":"\n",ca));comments&&(0===length?partial.push((comments.e?makeComment(comments.e[0],"\n"):"")+eolMind):partial.push(eolMind)),v=comments?prefix+wrap(token.arr,partial.join("")):0===partial.length?wrap(token.arr,""):prefix+wrap(token.arr,eolGap+partial.join(eolGap)+eolMind)}else{if(comments){var keys=comments.o.slice();for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&keys.indexOf(k)<0&&keys.push(k);for(i=0,length=keys.length;i<length;i++)k=keys[i],c=comments.c[k]||[],ca=commentOnThisLine(c[1]),partial.push(makeComment(c[0],"\n")+eolGap),v=str(value[k],ca),v&&partial.push(quoteKey(k)+token.col+(startsWithNL(v)?"":" ")+v),comments&&c[1]&&partial.push(makeComment(c[1],ca?" ":"\n",ca));0===length?partial.push((comments.e?makeComment(comments.e[0],"\n"):"")+eolMind):partial.push(eolMind)}else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(value[k]),v&&partial.push(quoteKey(k)+token.col+(startsWithNL(v)?"":" ")+v));v=0===partial.length?wrap(token.obj,""):comments?prefix+wrap(token.obj,partial.join("")):prefix+wrap(token.obj,eolGap+partial.join(eolGap)+eolMind)}return gap=mind,v}}function hjsonStringify(value,opt){var i,space,dsfDef=null;if(eol=common.EOL,indent="  ",keepComments=!1,bracesSameLine=!1,quoteAlways=!1,opt&&"object"==typeof opt&&("\n"!==opt.eol&&"\r\n"!==opt.eol||(eol=opt.eol),space=opt.space,keepComments=opt.keepWsc,bracesSameLine=opt.bracesSameLine,quoteAlways="always"===opt.quotes,dsfDef=opt.dsf,opt.colors===!0&&(token={obj:["[30;1m{[0m","[30;1m}[0m"],arr:["[30;1m[[0m","[30;1m][0m"],key:["[33m","[0m"],qkey:['[33m"','"[0m'],col:["[37m:[0m"],str:["[37;1m","[0m"],qstr:['[37;1m"','"[0m'],mstr:["[37;1m'''","'''[0m"],num:["[36;1m","[0m"],lit:["[36m","[0m"],dsf:["[37m","[0m"],esc:["[31m\\","[0m"],uni:["[31m\\u","[0m"],rem:["[30;1m","[0m"]})),runDsf=dsf.loadDsf(dsfDef,"stringify"),"number"==typeof space)for(indent="",i=0;i<space;i++)indent+=" ";else"string"==typeof space&&(indent=space);var res="",comments=keepComments?comments=(common.getComment(value)||{}).r:null;return comments&&comments[0]&&(res=comments[0]+"\n"),res+=str(value,null,!0,!0),comments&&(res+=comments[1]||""),res}var runDsf,eol,keepComments,bracesSameLine,quoteAlways,common=require("./hjson-common"),dsf=require("./hjson-dsf"),needsEscape=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,needsQuotes=/^\s|^"|^'''|^#|^\/\*|^\/\/|^\{|^\}|^\[|^\]|^:|^,|\s$|[\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,needsEscapeML=/'''|[\x00-\x09\x0b\x0c\x0e-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,startsWithKeyword=/^(true|false|null)\s*((,|\]|\}|#|\/\/|\/\*).*)?$/,meta={"\b":"b","\t":"t","\n":"n","\f":"f","\r":"r",'"':'"',"\\":"\\"},needsEscapeName=/[,\{\[\}\]\s:#"]|\/\/|\/\*|'''/,gap="",indent="  ",token={obj:["{","}"],arr:["[","]"],key:["",""],qkey:['"','"'],col:[":"],str:["",""],qstr:['"','"'],mstr:["'''","'''"],num:["",""],lit:["",""],dsf:["",""],esc:["\\",""],uni:["\\u",""],rem:["",""]};return hjsonStringify($value,$opt)}},{"./hjson-common":2,"./hjson-dsf":3}],6:[function(require,module,exports){module.exports="2.3.1"},{}],7:[function(require,module,exports){"use strict";var common=require("./hjson-common"),version=require("./hjson-version"),parse=require("./hjson-parse"),stringify=require("./hjson-stringify"),comments=require("./hjson-comments"),dsf=require("./hjson-dsf");module.exports={parse:parse,stringify:stringify,endOfLine:function(){return common.EOL},setEndOfLine:function(eol){"\n"!==eol&&"\r\n"!==eol||(common.EOL=eol)},version:version,rt:{parse:function(text,options){return(options=options||{}).keepWsc=!0,parse(text,options)},stringify:function(value,options){return(options=options||{}).keepWsc=!0,stringify(value,options)}},comments:comments,dsf:dsf.std}},{"./hjson-comments":1,"./hjson-common":2,"./hjson-dsf":3,"./hjson-parse":4,"./hjson-stringify":5,"./hjson-version":6}],8:[function(require,module,exports){exports.endianness=function(){return"LE"},exports.hostname=function(){return"undefined"!=typeof location?location.hostname:""},exports.loadavg=function(){return[]},exports.uptime=function(){return 0},exports.freemem=function(){return Number.MAX_VALUE},exports.totalmem=function(){return Number.MAX_VALUE},exports.cpus=function(){return[]},exports.type=function(){return"Browser"},exports.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},exports.networkInterfaces=exports.getNetworkInterfaces=function(){return{}},exports.arch=function(){return"javascript"},exports.platform=function(){return"browser"},exports.tmpdir=exports.tmpDir=function(){return"/tmp"},exports.EOL="\n"},{}],9:[function(require,module,exports){!function(e,r,a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():r[e]=a()}("Please",this,function(){"use strict";function e(){function e(e,r,a){var o=Math.random;return a instanceof l&&(o=a.random),Math.floor(o()*(r-e+1))+e}function r(e,r,a){var o=Math.random;return a instanceof l&&(o=a.random),o()*(r-e)+e}function a(e,r,a){return Math.max(r,Math.min(e,a))}function o(e,r){var a;switch(e){case"hex":for(a=0;a<r.length;a++)r[a]=F.HSV_to_HEX(r[a]);break;case"rgb":for(a=0;a<r.length;a++)r[a]=F.HSV_to_RGB(r[a]);break;case"rgb-string":for(a=0;a<r.length;a++){var o=F.HSV_to_RGB(r[a]);r[a]="rgb("+o.r+","+o.g+","+o.b+")"}break;case"hsv":break;default:console.error("Format not recognized.")}return r}function n(e){var r=F.HSV_to_RGB(e),a=(299*r.r+587*r.g+114*r.b)/1e3;return a>=128?"dark":"light"}function t(e){var r={};for(var a in e)e.hasOwnProperty(a)&&(r[a]=e[a]);return r}function l(e){function r(){o=(o+1)%256,n=(n+a[o])%256;var e=a[o];return a[o]=a[n],a[n]=e,a[(a[o]+a[n])%256]}for(var a=[],o=0,n=0,t=0;256>t;t++)a[t]=t;for(var l=0,F=0;256>l;l++){F=(F+a[l]+e.charCodeAt(l%e.length))%256;var s=a[l];a[l]=a[F],a[F]=s}this.random=function(){for(var e=0,a=0,o=1;8>e;e++)a+=r()*o,o*=256;return a/0x10000000000000000}}var F={},s={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgrey:"A9A9A9",darkgreen:"006400",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",grey:"808080",green:"008000",greenyellow:"ADFF2F",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgrey:"D3D3D3",lightgreen:"90EE90",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370D8",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"D87093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",rebeccapurple:"663399",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"},i=.618033988749895,u={hue:null,saturation:null,value:null,base_color:"",greyscale:!1,grayscale:!1,golden:!0,full_random:!1,colors_returned:1,format:"hex",seed:null},c={scheme_type:"analogous",format:"hex"},h={golden:!1,format:"hex"};return F.NAME_to_HEX=function(e){return e=e.toLowerCase(),e in s?s[e]:void console.error("Color name not recognized.")},F.NAME_to_RGB=function(e){return F.HEX_to_RGB(F.NAME_to_HEX(e))},F.NAME_to_HSV=function(e){return F.HEX_to_HSV(F.NAME_to_HEX(e))},F.HEX_to_RGB=function(e){var r=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(r,function(e,r,a,o){return r+r+a+a+o+o});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null},F.RGB_to_HEX=function(e){return"#"+((1<<24)+(e.r<<16)+(e.g<<8)+e.b).toString(16).slice(1)},F.HSV_to_RGB=function(e){var r,a,o,n,t,l,F,s,i=e.h,u=e.s,c=e.v;if(0===u)return{r:c,g:c,b:c};switch(i/=60,n=Math.floor(i),t=i-n,l=c*(1-u),F=c*(1-u*t),s=c*(1-u*(1-t)),n){case 0:r=c,a=s,o=l;break;case 1:r=F,a=c,o=l;break;case 2:r=l,a=c,o=s;break;case 3:r=l,a=F,o=c;break;case 4:r=s,a=l,o=c;break;case 5:r=c,a=l,o=F}return{r:Math.floor(255*r),g:Math.floor(255*a),b:Math.floor(255*o)}},F.RGB_to_HSV=function(e){var r=e.r/255,a=e.g/255,o=e.b/255,n=0,t=0,l=0,F=Math.min(r,Math.min(a,o)),s=Math.max(r,Math.max(a,o));if(F===s)return l=F,{h:0,s:0,v:l};var i=r===F?a-o:o===F?r-a:o-r,u=r===F?3:o===F?1:5;return n=60*(u-i/(s-F)),t=(s-F)/s,l=s,{h:n,s:t,v:l}},F.HSV_to_HEX=function(e){return F.RGB_to_HEX(F.HSV_to_RGB(e))},F.HEX_to_HSV=function(e){return F.RGB_to_HSV(F.HEX_to_RGB(e))},F.make_scheme=function(e,r){function n(e){return{h:e.h,s:e.s,v:e.v}}var l,F,s,i,u,h=t(c);if(null!==r)for(var d in r)r.hasOwnProperty(d)&&(h[d]=r[d]);var g=[e];switch(h.scheme_type.toLowerCase()){case"monochromatic":case"mono":for(u=1;2>=u;u++)l=n(e),s=l.s+.1*u,s=a(s,0,1),i=l.v+.1*u,i=a(i,0,1),l.s=s,l.v=i,g.push(l);for(u=1;2>=u;u++)l=n(e),s=l.s-.1*u,s=a(s,0,1),i=l.v-.1*u,i=a(i,0,1),l.s=s,l.v=i,g.push(l);break;case"complementary":case"complement":case"comp":l=n(e),l.h=(l.h+180)%360,g.push(l);break;case"split-complementary":case"split-complement":case"split":l=n(e),l.h=(l.h+165)%360,g.push(l),l=n(e),l.h=Math.abs((l.h-165)%360),g.push(l);break;case"double-complementary":case"double-complement":case"double":l=n(e),l.h=(l.h+180)%360,g.push(l),l.h=(l.h+30)%360,F=n(l),g.push(l),l.h=(l.h+180)%360,g.push(F);break;case"analogous":case"ana":for(u=1;5>=u;u++)l=n(e),l.h=(l.h+20*u)%360,g.push(l);break;case"triadic":case"triad":case"tri":for(u=1;3>u;u++)l=n(e),l.h=(l.h+120*u)%360,g.push(l);break;default:console.error("Color scheme not recognized.")}return o(h.format.toLowerCase(),g),g},F.make_color=function(n){var s=[],c=t(u),h=null;if(null!==n)for(var d in n)n.hasOwnProperty(d)&&(c[d]=n[d]);var g=null;"string"==typeof c.seed&&(g=new l(c.seed)),c.base_color.length>0&&(h=c.base_color.match(/^#?([0-9a-f]{3})([0-9a-f]{3})?$/i)?F.HEX_to_HSV(c.base_color):F.NAME_to_HSV(c.base_color));for(var m=0;m<c.colors_returned;m++){var f,E,b,p=e(0,360,g);null!==h?(f=a(e(h.h-5,h.h+5,g),0,360),E=0===h.s?0:r(.4,.85,g),b=r(.4,.85,g),s.push({h:f,s:E,v:b})):(f=c.greyscale===!0||c.grayscale===!0?0:c.golden===!0?(p+p/i)%360:null===c.hue||c.full_random===!0?p:a(c.hue,0,360),E=c.greyscale===!0||c.grayscale===!0?0:c.full_random===!0?r(0,1,g):null===c.saturation?.4:a(c.saturation,0,1),b=c.full_random===!0?r(0,1,g):c.greyscale===!0||c.grayscale===!0?r(.15,.75,g):null===c.value?.75:a(c.value,0,1),s.push({h:f,s:E,v:b}))}return o(c.format.toLowerCase(),s),s},F.make_contrast=function(e,r){var l=t(h);if(null!==r)for(var s in r)r.hasOwnProperty(s)&&(l[s]=r[s]);var u,c,d=n(e);if(l.golden===!0)c=e.h*(1+i)%360;else{var g=F.make_scheme(e,{scheme_type:"complementary",format:"hsv"})[1];c=a(g.h-30,0,360)}var m;return"dark"===d?m=a(e.v-.25,0,1):"light"===d&&(m=a(e.v+.25,0,1)),u=[{h:c,s:e.s,v:m}],o(l.format.toLowerCase(),u),u[0]},F}return e()})},{}],10:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),
Constructor}}(),_SLW=require("./SLW"),_Tile=(_interopRequireDefault(_SLW),require("./Tile")),BrowserSLW=(_interopRequireDefault(_Tile),require("./util"),function(){function BrowserSLW(game){_classCallCheck(this,BrowserSLW),this.game=game,this.header=document.getElementById("header");var editorToggle=this.addToggle(function(_Toggle){function _class(){return _classCallCheck(this,_class),_possibleConstructorReturn(this,(_class.__proto__||Object.getPrototypeOf(_class)).apply(this,arguments))}return _inherits(_class,_Toggle),_createClass(_class,[{key:"onCreate",value:function(){this.setTitle("Editor Mode"),this.setChecked(!1),this.setDisabled(!0)}},{key:"onCheckedChsfddanged",value:function(){var el=document.getElementById("toolbar");this.checked||(el.innerHTML=""),game.level.editorEnabled=this.checked}}]),_class}(Toggle));game.events.addEventListener("levelchanged",function(_ref){var level=_ref.level;level.meta.special.includes("world")?editorToggle.setDisabled(!0):editorToggle.setDisabled(!1)}),this.addToggle(function(_Toggle2){function _class2(){return _classCallCheck(this,_class2),_possibleConstructorReturn(this,(_class2.__proto__||Object.getPrototypeOf(_class2)).apply(this,arguments))}return _inherits(_class2,_Toggle2),_createClass(_class2,[{key:"onCreate",value:function(){this.setTitle("Gamepad"),this.load("gamepad-support"),game.gamepadSupport||this.setDisabled(!0)}},{key:"onDestroy",value:function(){this.save("gamepad-support")}},{key:"onCheckedChanged",value:function(){game.gamepadEnabled=this.checked}}]),_class2}(Toggle))}return _createClass(BrowserSLW,[{key:"addToggle",value:function(toggleClass){var toggle=new toggleClass,toggles=this.header.querySelector("#toggles");return toggles.appendChild(toggle.btn),toggle}}]),BrowserSLW}());exports.default=BrowserSLW;var Toggle=function(){function Toggle(){var _this3=this;_classCallCheck(this,Toggle),this.btn=document.createElement("button"),this.btn.addEventListener("click",function(){_this3.setChecked(!_this3.checked)}),this.onCreate(),window.addEventListener("beforeunload",function(){_this3.onDestroy()})}return _createClass(Toggle,[{key:"setChecked",value:function(newChecked){this.checked=newChecked,this.checked?(this.btn.classList.add("checked"),this.btn.classList.remove("unchecked")):(this.btn.classList.remove("checked"),this.btn.classList.add("unchecked")),this.onCheckedChanged()}},{key:"setDisabled",value:function(newDisabled){this.disabled=newDisabled,newDisabled?this.btn.setAttribute("disabled","true"):this.btn.removeAttribute("disabled")}},{key:"setTitle",value:function(newTitle){for(;this.btn.firstChild;)this.btn.removeChild(this.btn.firstChild);this.btn.appendChild(document.createTextNode(newTitle))}},{key:"load",value:function(key){"true"===localStorage["toggle-"+key]?this.setChecked(!0):this.setChecked(!1)}},{key:"save",value:function(key){localStorage["toggle-"+key]=this.checked.toString()}},{key:"onCreate",value:function(){}},{key:"onCheckedChanged",value:function(){}},{key:"onDestroy",value:function(){}}]),Toggle}()},{"./SLW":14,"./Tile":17,"./util":20}],11:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Cursor=function(){function Cursor(){var scale=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,1];_classCallCheck(this,Cursor),this.scale=scale,this.pos=[0,0],this.down=!1,this.image=new Image,this.image.src="sprites/cursor.png"}return _createClass(Cursor,[{key:"watchMouse",value:function(el){var _this=this;el.addEventListener("mousemove",function(evt){var rect=el.getBoundingClientRect();_this.pos[0]=(evt.clientX-rect.left)*_this.scale[0],_this.pos[1]=(evt.clientY-rect.top)*_this.scale[1]}),el.addEventListener("mouseup",function(){_this.down=!1}),el.addEventListener("mousedown",function(){_this.down=!0})}},{key:"drawUsingCtx",value:function(ctx){var x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pos[0],y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.pos[1],centeredX=x-this.image.width/2,centeredY=y-this.image.height/2;ctx.drawImage(this.image,centeredX,centeredY)}}]),Cursor}();exports.default=Cursor},{}],12:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.HalfwayFlag=exports.Coin=exports.Sign=exports.Mushroom=exports.Powerup=exports.Goomba=exports.Player=exports.Entity=void 0;var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_SLW=require("./SLW"),_Tile=(_interopRequireDefault(_SLW),require("./Tile")),_Tile2=_interopRequireDefault(_Tile),_Level=require("./Level"),_Level2=_interopRequireDefault(_Level),_Text=require("./Text"),_Text2=_interopRequireDefault(_Text),_util=(require("./SoundManager"),require("./util")),DEBUG=!1,GRAVITY=.25,Entity=exports.Entity=function(){function Entity(game){_classCallCheck(this,Entity),this.game=game,this.sprite={sheet:new Image,position:[0,0],positionType:"",width:0,height:0},this.x=0,this.y=0,this.z=0,this.xv=0,this.yv=0,this.w=16,this.h=16;var c=require("pleasejs").make_color({format:"rgb"})[0];this.color="rgb("+c.r+", "+c.g+", "+c.b+")"}return _createClass(Entity,[{key:"top",get:function(){return Math.floor(this.y)}},{key:"bottom",get:function(){return Math.floor(this.y+this.h)}},{key:"left",get:function(){return Math.floor(this.x)}},{key:"right",get:function(){return Math.floor(this.x+this.w)}}]),_createClass(Entity,[{key:"update",value:function(){var stop=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=0,xv=Math.round(this.xv);v=(0,_util.sign)(xv);for(var i=0;i<Math.abs(xv);i++)this.x+=v,(this.touchingWallRight||this.touchingWallLeft)&&(this.x-=v,stop&&(this.xv=0));var yv=Math.floor(this.yv);v=(0,_util.sign)(yv);for(var _i=0;_i<Math.abs(yv);_i++)if(this.y+=v,(1===v&&this.grounded||this.collides())&&(this.y-=v,stop&&(this.yv=0),this.y=Math.ceil(this.y/_Tile2.default.size)*_Tile2.default.size,v===-1)){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.tilesAbove[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var tile=_step.value;tile.onAirPunch(this)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}if(this.y>=this.game.level.h*_Tile2.default.size&&!this.game.level.meta.special.includes("world"))return this.destroy();var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=this.pickTiles(0,0,0,1)[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var _tile=_step2.value;_tile.onTouch(this)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this.tilesBelow[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var _tile2=_step3.value;_tile2.onStand(this)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=this.entityCollides()[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var entity=_step4.value;entity.onTouch(this)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}},{key:"draw",value:function(){var ctx=this.game.canvas.getContext("2d");if(ctx instanceof CanvasRenderingContext2D){DEBUG&&(ctx.fillStyle=this.color,ctx.fillRect(this.left,this.top,this.w+1,this.h+1),ctx.drawImage(_Text2.default.write(this.constructor.name,this.color),this.right,this.bottom));var sprite=this.sprite;if(sprite){var _ref=sprite.position||[0,0],_ref2=_slicedToArray(_ref,2),x=_ref2[0],y=_ref2[1],w=sprite.width||this.w,h=sprite.height||this.h;"absolute"!==sprite.positionType&&(x*=w,y*=h),ctx.drawImage(this.sprite.sheet,x,y,w,h,this.left,this.top,w,h)}}}},{key:"collides",value:function(){for(var shouldReturnTiles=arguments.length>0&&void 0!==arguments[0]&&arguments[0],tileLeft=Math.floor(this.left/_Tile2.default.size),tileRight=Math.floor(this.right/_Tile2.default.size),tileTop=Math.floor(this.top/_Tile2.default.size),tileBottom=Math.floor(this.bottom/_Tile2.default.size),tiles=[],collision=!1,x=tileLeft;x<=tileRight;x++)for(var y=tileTop;y<=tileBottom;y++){var tile=this.game.level.tileAt([x,y]);tile.solid&&(collision=!0),tiles.push(tile)}return shouldReturnTiles?tiles:collision}},{key:"pickTiles",value:function(tileLeft,tileRight,tileTop,tileBottom){for(var tiles=[],px=Math.floor(tileLeft);px<=Math.ceil(tileRight);px++)for(var py=Math.floor(tileTop);py<=Math.ceil(tileBottom);py++)tiles.push(this.game.level.tileAt([tileLeft+px+this.x/_Tile2.default.size,tileTop+py+this.y/_Tile2.default.size]));return tiles}},{key:"destroy",value:function(){this.game.entities.splice(this.game.entities.indexOf(this),1)}},{key:"entityCollides",value:function(){var entities=[],_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=this.game.entities[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var entity=_step5.value;entity!==this&&(this.left<=entity.left&&entity.left<=this.right||this.left<=entity.right&&entity.right<=this.right)&&(this.top<=entity.top&&entity.top<=this.bottom||this.top<=entity.bottom&&entity.bottom<=this.bottom)&&entities.push(entity)}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}return entities}},{key:"onTouch",value:function(by){}},{key:"touchingWallRight",get:function(){var tileLeft=Math.floor(this.right/_Tile2.default.size),tileRight=tileLeft,tileTop=Math.floor(this.top/_Tile2.default.size),tileBottom=Math.floor(this.bottom/_Tile2.default.size);16===this.h&&tileBottom--;for(var x=tileLeft;x<=tileRight;x++)for(var y=tileTop;y<=tileBottom;y++){var tile=this.game.level.tileAt([x,y]);if(tile.solid)return!0}return!1}},{key:"touchingWallLeft",get:function(){var tileLeft=Math.floor(this.left/_Tile2.default.size),tileRight=tileLeft,tileTop=Math.floor(this.top/_Tile2.default.size),tileBottom=Math.floor(this.bottom/_Tile2.default.size);16===this.h&&tileBottom--;for(var x=tileLeft;x<=tileRight;x++)for(var y=tileTop;y<=tileBottom;y++){var tile=this.game.level.tileAt([x,y]);if(tile.solid)return!0}return!1}},{key:"tileOn",get:function(){var t=this.game.level.tileAt([Math.floor((this.x+this.w/2)/16),Math.floor((this.y+this.h/2)/16)]);return t}},{key:"tilesAbove",get:function(){var l=this.game.level.tileAt([Math.floor(this.x/16),this.top/16-.1]),r=this.game.level.tileAt([Math.ceil(this.x/16),this.top/16-.1]);return[l,r]}},{key:"tilesBelow",get:function(){var l=this.game.level.tileAt([Math.floor(this.x/16),this.bottom/16+.1]),r=this.game.level.tileAt([Math.ceil(this.x/16),this.bottom/16+.1]);return[l,r]}},{key:"grounded",get:function(){return this.tilesBelow.some(function(tile){return tile.solid||tile.solidTop})}}]),Entity}(),Player=exports.Player=function(_Entity){function Player(game){var x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,Player);var _this=_possibleConstructorReturn(this,(Player.__proto__||Object.getPrototypeOf(Player)).call(this,game));return _this.sprite.sheet.src="sprites/liam-0.png",_this.sprite.position=[-100,-100],_this.sprite.positionType="absolute",_this.sprite.width=19,_this.sprite.height=32,_this.spriteAnimation={time:0,dir:"right",anim:"idle",oldAnim:"",nextFrame:0},_this.x=x,_this.y=y,_this.w=15,_this.h=15,_this.state=0,_this.errorSound=_this.game.sounds.getSound("smw_stomp_koopa_kid.wav"),_this.startLevelSound=_this.game.sounds.getSound("begin_level"),_this.moveLevelSound=_this.game.sounds.getSound("move_level"),_this.jumpSound=_this.game.sounds.getSound("smw_jump"),_this}return _inherits(Player,_Entity),_createClass(Player,[{key:"update",value:function(){return this.game.level.editorEnabled?(this.xv=0,void(this.yv=0)):(this.sprite.sheet.src="sprites/liam-"+this.state+".png",this.state>0?(this.w=15,this.h=31,this.sprite.width=19,this.sprite.height=32,this.sprite.positionType="absolute"):(this.w=15,this.h=15,this.sprite.width=16,this.sprite.height=16),this.game.level.meta.special.includes("world")?this.mapMotion():this.levelMotion(),_get(Player.prototype.__proto__||Object.getPrototypeOf(Player.prototype),"update",this).call(this,1==this.wantsInput||!this.game.level.meta.special.includes("world")),void(this.game.level.meta.special.includes("world")&&(this.xv||this.yv)&&(this.wantsInput&&this.moveLevelSound.playNew(),this.wantsInput=!1)))}},{key:"mapMotion",value:function(){var walkSpeed=4;this.w=15,this.h=15;var on=void 0,tileX=this.left/_Tile2.default.size,tileY=this.top/_Tile2.default.size;if(on=Number.isInteger(tileX)&&Number.isInteger(tileY)?this.game.level.tileAt([tileX,tileY]):this.lastOn,this.lastOn||(this.wantsInput=!0),on&&["Level","House","Pipe"].includes(on.name)&&on!==this.lastOn&&(this.wantsInput=!0),on&&"Path"===on.name&&!this.wantsInput){if(this.spriteAnimation.anim="walk",this.xv>0&&(this.spriteAnimation.dir="right"),this.xv<0&&(this.spriteAnimation.dir="left"),this.yv>0&&(this.spriteAnimation.dir="down"),this.yv<0&&(this.spriteAnimation.dir="up"),!this.lastOn||on.texPosition!==this.lastOn.texPosition){var _on$texPosition=_slicedToArray(on.texPosition,2),h=_on$texPosition[0],v=_on$texPosition[1];3==h&&9==v&&(0===this.yv?(this.xv=0,this.yv=-walkSpeed):(this.xv=-walkSpeed,this.yv=0)),3==h&&8==v&&(0===this.yv?(this.xv=0,this.yv=walkSpeed):(this.xv=walkSpeed,this.yv=0)),1==h&&8==v&&(0===this.yv?(this.xv=0,this.yv=-walkSpeed):(this.xv=walkSpeed,this.yv=0)),1==h&&10==v&&(0===this.yv?(this.xv=0,this.yv=walkSpeed):(this.xv=-walkSpeed,this.yv=0)),2==h&&10==v&&(this.xv=0,this.yv=0,this.wantsInput=!0)}}else if(this.wantsInput&&(this.xv=0,this.yv=0,this.spriteAnimation.anim="idle",(0,_util.isRight)(this.game.keys)?(this.xv=walkSpeed,this.spriteAnimation.dir="right"):this.xv>0&&(this.xv=0),(0,_util.isLeft)(this.game.keys)?(this.xv=-walkSpeed,this.spriteAnimation.dir="left"):this.xv<0&&(this.xv=0),(0,_util.isDown)(this.game.keys)?(this.yv=walkSpeed,this.spriteAnimation.dir="down"):this.yv>0&&(this.yv=0),(0,_util.isUp)(this.game.keys)?(this.yv=-walkSpeed,this.spriteAnimation.dir="up"):this.yv<0&&(this.yv=0),on&&"Level"===on.name&&(0,_util.isYes)(this.game.newKeys))){var lv=this.game.level.meta.id+"-"+on.levelid;if(lv in _util.levels){this.w=15,this.h=31;var newLevel=new _Level2.default(this.game,lv,this.game.level.tileset);this.game.changeLevel(newLevel),this.game.tick=0,this.startLevelSound.playNew()}else this.errorSound.playNew()}this.lastOn=on}},{key:"levelMotion",value:function(){Math.abs(this.xv)<.2&&this.grounded&&(this.spriteAnimation.anim="idle"),(0,_util.isRight)(this.game.keys)?(this.xv+=.2,this.grounded&&(this.spriteAnimation.anim="walk")):this.xv>0&&(this.xv=Math.max(0,this.xv-.4)),(0,_util.isLeft)(this.game.keys)?(this.xv-=.2,this.grounded&&(this.spriteAnimation.anim="walk")):this.xv<0&&(this.xv=Math.min(0,this.xv+.4)),Math.abs(this.xv)<.1&&(this.xv=0),this.xv=Math.min(this.xv,4),this.xv=Math.max(this.xv,-4),this.grounded&&(0,_util.isJump)(this.game.keys)&&this.mayJump?(this.yv=-3.5,this.lastJump=Date.now(),this.jumpSound.playNew(),this.spriteAnimation.anim="jump",this.mayJump=!1):(0,_util.isJump)(this.game.keys)&&this.yv<-3&&Date.now()-this.lastJump<100+50*Math.abs(this.xv)?this.yv=-3.5:(0,_util.isJump)(this.game.keys)||(this.mayJump=!0),this.yv>0&&"jump"!==this.spriteAnimation.anim&&!this.grounded&&(this.spriteAnimation.anim="fall"),this.xv>0&&(this.spriteAnimation.dir="right"),this.xv<0&&(this.spriteAnimation.dir="left"),this.yv=Math.min(this.yv,4),this.yv+=GRAVITY}},{key:"draw",value:function(){var anim=this.spriteAnimation;anim.anim!==anim.oldAnim&&(anim.oldAnim=anim.anim,anim.time=0,anim.nextFrame=0),"walk"===anim.anim||"idle"===anim.anim&&"walk"===anim.oldAnim?anim.time>=anim.nextFrame&&(anim.nextFrame=Math.ceil(anim.time+Math.max(12-Math.abs(3*this.xv),8)),0===this.state?32===this.sprite.position[0]?this.sprite.position[0]=0:16===this.sprite.position[0]?this.sprite.position[0]=32:0===this.sprite.position[0]?"walk"===anim.anim&&(this.sprite.position[0]=16):this.sprite.position[0]=0:57===this.sprite.position[0]?this.sprite.position[0]=0:38===this.sprite.position[0]?this.sprite.position[0]=57:19===this.sprite.position[0]?"walk"===anim.anim&&(this.sprite.position[0]=38):this.sprite.position[0]=19):"idle"===anim.anim?this.sprite.position[0]=0===this.state?0:19:"jump"===anim.anim?this.sprite.position[0]=0===this.state?48:76:"fall"===anim.anim&&(this.sprite.position[0]=0===this.state?32:97),this.sprite.position[1]=0===this.state?{left:16,right:0,up:48,down:32}[anim.dir]:"left"===anim.dir?32:0,this.spriteAnimation.time++,_get(Player.prototype.__proto__||Object.getPrototypeOf(Player.prototype),"draw",this).call(this)}},{key:"destroy",value:function(){var lv=this.game.level.meta.world,newLevel=(this.game.level.meta.id,new _Level2.default(this.game,lv,this.game.level.tileset));this.game.changeLevel(newLevel),this.state=0}}]),Player}(Entity),Powerup=(exports.Goomba=function(_Entity2){function Goomba(game){var x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,Goomba);var _this2=_possibleConstructorReturn(this,(Goomba.__proto__||Object.getPrototypeOf(Goomba)).call(this,game));return _this2.x=x,_this2.y=y,_this2.z=1,_this2.w=16,_this2.h=16,_this2.xv=2,_this2}return _inherits(Goomba,_Entity2),_createClass(Goomba,[{key:"update",value:function(){this.yv+=GRAVITY,_get(Goomba.prototype.__proto__||Object.getPrototypeOf(Goomba.prototype),"update",this).call(this)}}]),Goomba}(Entity),exports.Powerup=function(_Entity3){function Powerup(game){var x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,xv=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;_classCallCheck(this,Powerup);var _this3=_possibleConstructorReturn(this,(Powerup.__proto__||Object.getPrototypeOf(Powerup)).call(this,game));return _this3.sprite.sheet.src="tileset.png",_this3.x=x,_this3.y=y,_this3.z=2,_this3.w=16,_this3.h=16,_this3.xv=xv,_this3.sprite.position=[0,0],_this3.game.sounds.getSound("powerup_init").playNew(),_this3.getSound=_this3.game.sounds.getSound("powerup_get"),_this3}return _inherits(Powerup,_Entity3),_createClass(Powerup,[{key:"update",value:function(){this.yv+=.7*GRAVITY;var o=this.xv;this.x+=this.xv,(this.touchingWallRight||this.touchingWallLeft)&&(o=this.xv*-1),this.x-=this.xv,this.xv=o,_get(Powerup.prototype.__proto__||Object.getPrototypeOf(Powerup.prototype),"update",this).call(this)}},{key:"onTouch",value:function(by){by instanceof Player&&(this.destroy(),this.getSound.playNew())}}]),Powerup}(Entity));exports.Mushroom=function(_Powerup){function Mushroom(){var _ref3;_classCallCheck(this,Mushroom);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var _this4=_possibleConstructorReturn(this,(_ref3=Mushroom.__proto__||Object.getPrototypeOf(Mushroom)).call.apply(_ref3,[this].concat(_toConsumableArray(args))));return _this4.sprite.position=[0,2],_this4}return _inherits(Mushroom,_Powerup),_createClass(Mushroom,[{key:"onTouch",value:function(by){by instanceof Player&&0===by.state&&(by.state=1,by.y-=_Tile2.default.size),_get(Mushroom.prototype.__proto__||Object.getPrototypeOf(Mushroom.prototype),"onTouch",this).call(this,by)}}]),Mushroom}(Powerup),exports.Sign=function(_Entity4){function Sign(game){var x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,Sign);var _this5=_possibleConstructorReturn(this,(Sign.__proto__||Object.getPrototypeOf(Sign)).call(this,game));return _this5.x=x,_this5.y=y,_this5.w=44,_this5.h=45,_this5.game.entities.push(_this5),_this5.sprite.sheet.src="tileset.png",_this5.sprite.positionType="absolute",_this5.sprite.position=[80,32],_this5.sprite.width=44,_this5.sprite.height=47,_this5}return _inherits(Sign,_Entity4),Sign}(Entity),exports.Coin=function(_Entity5){function Coin(game){var x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,Coin);var _this6=_possibleConstructorReturn(this,(Coin.__proto__||Object.getPrototypeOf(Coin)).call(this,game));return _this6.x=x,_this6.y=y,_this6.w=16,_this6.h=16,_this6.sprite.sheet.src="sprites/coin.png",_this6.sprite.width=16,_this6.sprite.height=16,_this6.spriteAnimation={time:0,nextFrame:0},_this6.coinSound=_this6.game.sounds.getSound("smw_coin"),_this6}return _inherits(Coin,_Entity5),_createClass(Coin,[{key:"update",value:function(){var anim=this.spriteAnimation;anim.time>=anim.nextFrame&&(anim.nextFrame=anim.time+10,this.sprite.position[0]=(this.sprite.position[0]+1)%4),anim.time++}},{key:"onTouch",value:function(by){by instanceof Player&&(this.coinSound.playNew(),this.destroy())}}]),Coin}(Entity),exports.HalfwayFlag=function(_Entity6){function HalfwayFlag(game){var x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,HalfwayFlag);var _this7=_possibleConstructorReturn(this,(HalfwayFlag.__proto__||Object.getPrototypeOf(HalfwayFlag)).call(this,game));return _this7.x=x,_this7.y=y-16,_this7.w=16,_this7.h=33,_this7.state=0,_this7.game.entities.push(_this7),_this7.sprite.sheet.src="sprites/flag.png",_this7.sprite.width=16,_this7.sprite.height=16,_this7.sprite.positionType="absolute",_this7.spriteAnimation={time:0,nextFrame:0,frame:0},_this7}return _inherits(HalfwayFlag,_Entity6),_createClass(HalfwayFlag,[{key:"update",value:function(){var anim=this.spriteAnimation;anim.time>=anim.nextFrame&&(anim.nextFrame=anim.time+10,anim.frame=(anim.frame+1)%4),anim.time++,this.sprite.position[0]=[18,35,52,69][anim.frame],this.sprite.position[1]=[1,35][this.state]}},{key:"draw",value:function(){var ctx=this.game.canvas.getContext("2d");ctx&&(ctx.drawImage(this.sprite.sheet,1,1,16,48,this.left-10,this.top-16,16,48),_get(HalfwayFlag.prototype.__proto__||Object.getPrototypeOf(HalfwayFlag.prototype),"draw",this).call(this))}},{key:"onTouch",value:function(by){by instanceof Player&&(this.state=1)}}]),HalfwayFlag}(Entity)},{"./Level":13,"./SLW":14,"./SoundManager":15,"./Text":16,"./Tile":17,"./util":20,pleasejs:9}],13:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_SLW=require("./SLW"),_Tile=(_interopRequireDefault(_SLW),require("./Tile")),tiles=_interopRequireWildcard(_Tile),_Entity=require("./Entity"),entities=_interopRequireWildcard(_Entity),_util=require("./util"),MUSIC_VOLUMES=(require("./SoundManager"),{airship:.25,athletic:.25,beach:1,castle:.25,"ice-cave":.25,"file-select":.5,"flower-gardens":1,grassland:.15,jungle:.25,"kapper-valley":.25,"star-world":.25,"underwater-underworld":1,water:.25,underground:.5}),Level=function(){function Level(game,levelid,tileset){_classCallCheck(this,Level),this.game=game,this.tileset=tileset,this.entities=[],this.meta=_util.levels[levelid];var tilemap=this.meta.tiles;this.tiles=[];var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=tilemap[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var k=_step.value,id=k[0],x=k[1],y=k[2],layer=k[3],opts=k[4],tile=new tiles[id](this.game,opts);tile.x=x,tile.y=y,tile.layer=layer,tile.game=game,tile.exists=!0,this.tiles.push(tile)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}this.h=this.meta.height,this.w=this.meta.width,this.music=this.game.sounds.getSound("music/"+this.meta.music+".mp3"),this.music.volume=MUSIC_VOLUMES[this.meta.music]||.5,this.music.loops=!0,this.music.playNew()}return _createClass(Level,null,[{key:"metaOf",value:function(levelid){return _util.levels[levelid]}}]),_createClass(Level,[{key:"create",value:function(){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=this.tiles[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var tile=_step2.value;tile.onCreate()}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this.meta.entities[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var def=_step3.value,_constructor=entities[def.shift()],ent=new(Function.prototype.bind.apply(_constructor,[null].concat([this.game],_toConsumableArray(def))));this.entities.push(ent)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}},{key:"destroy",value:function(){this.music.stop(),this.game.entities.splice(0,this.game.entities.length)}},{key:"update",value:function(){var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=this.tiles[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var tile=_step4.value;tile.onUpdate()}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}},{key:"draw",value:function(){var ctx=this.game.canvas.getContext("2d");if(ctx instanceof CanvasRenderingContext2D)for(var viewStartX=Math.floor(this.game.camera[0]/tiles.default.size),viewStartY=Math.floor(this.game.camera[1]/tiles.default.size),viewEndX=Math.ceil(this.game.camera[0]/tiles.default.size)+25,viewEndY=Math.ceil(this.game.camera[1]/tiles.default.size)+25,y=viewStartY;y<viewEndY;y++)for(var x=viewStartX;x<viewEndX;x++){var _tiles=this.tilesAt([x,y]),_getAbsolutePosition=this.getAbsolutePosition([x,y]),_getAbsolutePosition2=_slicedToArray(_getAbsolutePosition,2),rendX=_getAbsolutePosition2[0],rendY=_getAbsolutePosition2[1],_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=_tiles[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var tile=_step5.value,_tile$texPosition=_slicedToArray(tile.texPosition,2),tileX=_tile$texPosition[0],tileY=_tile$texPosition[1];
ctx.drawImage(this.tileset,tileX*tiles.default.size,tileY*tiles.default.size,tiles.default.size,tiles.default.size,rendX+tile.dx,rendY+tile.dy,tiles.default.size,tiles.default.size)}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}}}},{key:"tileAt",value:function(_ref){var _ref2=_slicedToArray(_ref,2),tileX=_ref2[0],tileY=_ref2[1],layer=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;tileX=Math.floor(tileX),tileY=Math.floor(tileY),layer=Math.floor(layer);try{var r=this.tiles.filter(function(tile){return tile.layer===layer&&tile.x===tileX&&tile.y===tileY})[0];if("undefined"==typeof r)throw"nope";return r}catch(e){return new tiles.Air(this.game)}}},{key:"tilesAt",value:function(_ref3){var _ref4=_slicedToArray(_ref3,2),tileX=_ref4[0],tileY=_ref4[1];return tileX=Math.floor(tileX),tileY=Math.floor(tileY),this.tiles.filter(function(tile){return tile.x===tileX&&tile.y===tileY})}},{key:"replaceTile",value:function(_ref5,newTile){var _ref6=_slicedToArray(_ref5,2),tileX=_ref6[0],tileY=_ref6[1],layer=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;newTile.x=tileX,newTile.y=tileY,newTile.layer=layer,newTile.game=this.game,newTile.exists=!0;var oldTile=this.tileAt([tileX,tileY],layer);oldTile.exists=!1,oldTile.onDestroy(),this.tiles.push(newTile),newTile.onCreate();for(var y=tileY-1;y<=tileY+1;y++)for(var x=tileX-1;x<=tileX+1;x++){var tile=this.tileAt([x,y],layer);tile&&tile!==newTile&&tile.onNearbyReplace()}return newTile}},{key:"getAbsolutePosition",value:function(_ref7){var _ref8=_slicedToArray(_ref7,2),tileX=_ref8[0],tileY=_ref8[1];return[Math.floor(tileX*tiles.default.size),Math.floor(tileY*tiles.default.size)]}}]),Level}();exports.default=Level},{"./Entity":12,"./SLW":14,"./SoundManager":15,"./Tile":17,"./util":20}],14:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Tile=require("./Tile"),_Tile2=_interopRequireDefault(_Tile),_Text=require("./Text"),_Text2=_interopRequireDefault(_Text),_Level=require("./Level"),_Level2=_interopRequireDefault(_Level),_Cursor=require("./Cursor"),_Cursor2=_interopRequireDefault(_Cursor),_SoundManager=require("./SoundManager"),_SoundManager2=_interopRequireDefault(_SoundManager),_Entity=require("./Entity"),_util=require("./util"),BG_COLORS={clouds:"#A0D0F8",hills:"#F8E0B0"},BG_REPEATS={clouds:"repeat-x",hills:"repeat-y"},SLW=function(){function SLW(levelid,tileset){var _this=this;_classCallCheck(this,SLW),this.events=new _util.EventController,this.events.registerEvent("levelchanged"),this.sounds=new _SoundManager2.default,this.keys={},this.newKeys={},this.canvas=document.createElement("canvas"),this.canvas.width=400,this.canvas.height=400,this.canvas.setAttribute("tabindex","1"),window.addEventListener("keydown",function(evt){_this.keys[evt.keyCode||evt.which]=!0,_this.newKeys[evt.keyCode||evt.which]=!0}),window.addEventListener("keyup",function(evt){_this.keys[evt.keyCode||evt.which]=!1}),this.player=new _Entity.Player(this,16,16),this.camera=[0,0],this.cameraInEditor=[0,0],this.cursor=new _Cursor2.default([.5,.5]),this.cursor.watchMouse(this.canvas),this.lastPlacePos=[0,0],this.entities=[],this.changeLevel(new _Level2.default(this,levelid,tileset)),this.gamepadSupport="GamepadEvent"in window||"getGamepads"in navigator,this.gamepadEnabled=!1,this.genericTilePlaceSound=this.sounds.getSound("smw_fireball")}return _createClass(SLW,[{key:"canvasClear",value:function(){var ctx=this.canvas.getContext("2d");ctx instanceof CanvasRenderingContext2D&&(ctx.fillStyle=BG_COLORS[this.level.meta.background]||"black",ctx.fillRect(0,0,this.canvas.width,this.canvas.height))}},{key:"gamepadInput",value:function(){try{if(this.gamepadSupport&&this.gamepadEnabled){var gamepads=window.navigator.getGamepads();if(gamepads.length>0){for(var newest=gamepads[0],i=0;i<gamepads.length;i++){var gamepad=gamepads[i];gamepad.connected&&newest.timestamp<gamepad.timestamp&&(newest=gamepad)}var pad=newest;this.keys[90]=pad.buttons[1].pressed,this.keys[80]=pad.buttons[2].pressed,this.keys[37]=pad.axes[0]<-.5,this.keys[39]=pad.axes[0]>.5,this.keys[38]=pad.axes[1]<-.5,this.keys[40]=pad.axes[1]>.5}}}catch(e){console.warn(e)}}},{key:"cameraUpdate",value:function(){var minY=_Tile2.default.size+this.canvas.height/2,maxY=(this.level.h-1)*_Tile2.default.size-this.canvas.height/2,minX=_Tile2.default.size+this.canvas.width/2,maxX=(this.level.w-1)*_Tile2.default.size-this.canvas.width/2;if(this.level.editorEnabled){var CAM_SPD=4;(0,_util.isUp)(this.keys)&&(this.cameraInEditor[1]-=CAM_SPD),(0,_util.isDown)(this.keys)&&(this.cameraInEditor[1]+=CAM_SPD),(0,_util.isLeft)(this.keys)&&(this.cameraInEditor[0]-=CAM_SPD),(0,_util.isRight)(this.keys)&&(this.cameraInEditor[0]+=CAM_SPD),this.cameraInEditor[0]=Math.min(maxX,Math.max(minX,this.cameraInEditor[0])),this.cameraInEditor[1]=Math.min(maxY,Math.max(minY,this.cameraInEditor[1]))}var x=this.level.editorEnabled?this.cameraInEditor[0]:this.player.x,y=this.level.editorEnabled?this.cameraInEditor[1]:this.player.y;if(y<minY&&(y=minY),y>maxY&&(y=maxY),x<minX&&(x=minX),x>maxX&&(x=maxX),this.level.meta.special.includes("floating")){var wave=Math.sin(this.tick/40)*_Tile2.default.size/2;y+=wave}var lag=this.tick>0?8:1;this.camera[0]+=(x-this.canvas.width/2-this.camera[0])/lag,this.camera[1]+=(y-this.canvas.height/2-this.camera[1])/lag}},{key:"entityUpdate",value:function(){this.entities.forEach(function(e){return e.update()})}},{key:"changeLevel",value:function(newLevel){var oldLevel=this.level;oldLevel&&oldLevel.destroy(),this.tick=0,this.level=newLevel,newLevel.create(),this.events.dispatchEvent("levelchanged",{oldLevel:oldLevel||null,level:newLevel})}},{key:"draw",value:function(){var ctx=this.canvas.getContext("2d");if(ctx instanceof CanvasRenderingContext2D){var tx=-.25*this.camera[0],ty=-.25*this.camera[1];if(this.level.meta.special.includes("floating")&&(tx+=-.25*this.tick),ctx.save(),ctx.translate(tx,ty),"none"===this.level.meta.background)var ptrn="black";else{var bg=new Image;bg.src="background/"+this.level.meta.background+".png";var ptrn=ctx.createPattern(bg,BG_REPEATS[this.level.meta.background]||"repeat")}ctx.fillStyle=ptrn,ctx.fillRect(-tx,-ty,this.canvas.width,this.canvas.height),ctx.restore(),ctx.save(),ctx.translate(Math.floor(-this.camera[0]),Math.floor(-this.camera[1]));var entities=this.entities.sort(function(a,b){return a.z>b.z?1:a.z<b.z?-1:0});if(entities.filter(function(e){return e.z<0}).forEach(function(e){return e.draw()}),this.level.draw(),entities.filter(function(e){return e.z>=0}).forEach(function(e){return e.draw()}),this.player.draw(),ctx.restore(),this.level.meta.special.includes("world")){var on=this.player.tileOn,str=this.level.meta.name;if("Level"===on.name){var level=_Level2.default.metaOf(this.level.meta.id+"-"+on.levelid);str+=level?" . "+(on.levelid||0)+" "+level.name:" . Level doesn't exist rip"}ctx.drawImage(_Text2.default.write(str),16,16)}if(ctx.drawImage(_Text2.default.write("\nCursor XY   "+this.cursor.pos.map(function(p){return Math.floor(p)}).join(" ")+"\nCursor Down "+this.cursor.down.toString()+"\nPlayer XY   "+(this.player.x+" "+this.player.y)+"\nCamera XY   "+this.camera.map(function(p){return Math.floor(p)}).join(" ")+"\n    ","rgba(0, 0, 0, 0.5)"),16,32),this.level.editorEnabled){var _cursor$pos=_slicedToArray(this.cursor.pos,2),cursorX=_cursor$pos[0],cursorY=_cursor$pos[1],roundTileX=cursorX%_Tile2.default.size;roundTileX<_Tile2.default.size/2?cursorX-=roundTileX:cursorX+=_Tile2.default.size-roundTileX;var roundTileY=cursorY%_Tile2.default.size;roundTileY<_Tile2.default.size/2?cursorY-=roundTileY:cursorY+=_Tile2.default.size-roundTileY;var cursorTileX=cursorX/_Tile2.default.size,cursorTileY=cursorY/_Tile2.default.size;cursorTileX+=Math.floor(this.camera[0]/_Tile2.default.size),cursorTileY+=Math.floor(this.camera[1]/_Tile2.default.size),cursorX-=this.camera[0]%_Tile2.default.size,cursorY-=this.camera[1]%_Tile2.default.size,cursorX+=_Tile2.default.size/2,cursorY+=_Tile2.default.size/2,this.cursor.drawUsingCtx(ctx,cursorX,cursorY);var tilePos=[cursorTileX,cursorTileY];if(this.cursor.down&&!(0,_util.arrEqual)(this.lastPlacePos,tilePos)){var tile=new this.tileToPaint(this);this.level.replaceTile([cursorTileX,cursorTileY],tile),this.lastPlacePos=tilePos,this.genericTilePlaceSound.makeNew().then(function(sound){sound.rate=.9+.2*Math.random(),sound.start()})}}this.newKeys={},this.tick++}}}]),SLW}();exports.default=SLW},{"./Cursor":11,"./Entity":12,"./Level":13,"./SoundManager":15,"./Text":16,"./Tile":17,"./util":20}],15:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),SoundManager=function(){function SoundManager(){_classCallCheck(this,SoundManager),this.sounds=new Map,this.ctx=new AudioContext,this.urlTemplate=function(u){var ext=u.match(/\.[^.]*$/);return ext?"sound/"+u:"sound/"+u+".wav"}}return _createClass(SoundManager,[{key:"getSound",value:function(name){if(this.sounds.has(name))return this.sounds.get(name);var sound=new Sound(this,this.urlTemplate(name));return this.sounds.set(name,sound),sound.load(),sound}}]),SoundManager}();exports.default=SoundManager;var Sound=exports.Sound=function(){function Sound(manager,srcURL){_classCallCheck(this,Sound),this.manager=manager,this.srcURL=srcURL,this.dataBufferLoaded=!1,this.loops=!1,this.volume=1,this.sources=[]}return _createClass(Sound,[{key:"load",value:function(){var _this=this;return this.loadingPromise?this.loadingPromise:(this.loadingPromise=fetch(this.srcURL).then(function(response){return response.arrayBuffer()}).then(function(buf){return _this.manager.ctx.decodeAudioData(buf)}).then(function(data){_this.dataBuffer=data,_this.dataBufferLoaded=!0}),this.loadingPromise)}},{key:"playNew",value:function(){this.makeNew().then(function(sound){sound.start()})}},{key:"makeNew",value:function(){var _this2=this;if(this.dataBufferLoaded){var source=new SoundSource(this,this.dataBuffer);return this.sources.push(source),Promise.resolve(source)}return this.load().then(function(){return _this2.makeNew()})}},{key:"stop",value:function(){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.sources[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var source=_step.value;source.stop()}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}this.sources.splice(0,this.sources.length)}}]),Sound}(),SoundSource=exports.SoundSource=function(){function SoundSource(sound,buffer){_classCallCheck(this,SoundSource),this.manager=sound.manager,this.source=this.manager.ctx.createBufferSource(),this.source.buffer=buffer,this.source.loop=sound.loops,this.gainNode=this.manager.ctx.createGain(),this.source.connect(this.gainNode),this.gainNode.connect(this.manager.ctx.destination),this.volume=sound.volume}return _createClass(SoundSource,[{key:"start",value:function(){this.source.start(0)}},{key:"stop",value:function(){this.source.stop()}},{key:"volume",set:function(value){this.gainNode.gain.value=value},get:function(){return this.gainNode.gain.value}},{key:"rate",set:function(value){this.source.playbackRate.value=value},get:function(){return this.source.playbackRate.value}}]),SoundSource}()},{}],16:[function(require,module,exports){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_util=require("./util");exports.default=Text={write:function(){var str=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",color=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"black",canvas=document.createElement("canvas");canvas.width=8*Math.max.apply(Math,_toConsumableArray(str.split("\n").map(function(chars){return chars.length}))),canvas.height=8*str.split("\n").length;var ctx=canvas.getContext("2d");if(!ctx)throw new TypeError("Failed to get new canvas context.");var img=(0,_util.tint)(Text.set,color),x=0,y=0;for(var i in str){var char=str[i];if("\n"===char)x=0,y+=8;else{var _ref=Text.map[char]||[0,0],_ref2=_slicedToArray(_ref,2),dx=_ref2[0],dy=_ref2[1];ctx.drawImage(img,8*dx,8*dy+1,8,8,x,y,8,8),x+=8}}return canvas},set:new Image,map:{A:[0,0],B:[1,0],C:[2,0],D:[3,0],E:[4,0],F:[5,0],G:[6,0],H:[7,0],I:[8,0],J:[9,0],K:[10,0],L:[11,0],M:[12,0],N:[13,0],O:[14,0],P:[15,0],Q:[16,0],R:[17,0],S:[0,1],T:[1,1],U:[2,1],V:[3,1],W:[4,1],X:[5,1],Y:[6,1],Z:[7,1],a:[8,1],b:[9,1],c:[10,1],d:[11,1],e:[12,1],f:[13,1],g:[14,1],h:[15,1],i:[16,1],j:[17,1],k:[0,2],l:[1,2],m:[2,2],n:[3,2],o:[4,2],p:[5,2],q:[6,2],r:[7,2],s:[8,2],t:[9,2],u:[10,2],v:[11,2],w:[12,2],x:[13,2],y:[14,2],z:[15,2],"?":[0,3],"!":[1,3],".":[2,3],"'":[3,3],"(":[4,3],")":[5,3],"#":[6,3]," ":[7,3],"-":[8,3],0:[0,4],1:[1,4],2:[2,4],3:[3,4],4:[4,4],5:[5,4],6:[6,4],7:[7,4],8:[8,4],9:[9,4]}},Text.set.src="sprites/text.png"},{"./util":20}],17:[function(require,module,exports){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.UsedBlock=exports.QuestionBlock=exports.Air=void 0;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_SLW=require("./SLW"),_util=(_interopRequireDefault(_SLW),require("./util")),_Entity=require("./Entity"),Tile=(_interopRequireWildcard(_Entity),function(){function Tile(game){var props=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,Tile),this.game=game,this.name=props.name||"Unknown",this.texPosition=props.texPosition,this.solid=props.solid||!1,this.solidTop=props.solidTop||!1,this.exists=!1,this.dx=0,this.dy=0}return _createClass(Tile,[{key:"onCreate",value:function(){}},{key:"onDestroy",value:function(){}},{key:"onUpdate",value:function(){}},{key:"onNearbyReplace",value:function(){}},{key:"onTouch",value:function(by){}},{key:"onStand",value:function(by){}},{key:"onAirPunch",value:function(){}}]),Tile}());exports.default=Tile,Tile.size=16;var UsedBlock=(exports.Air=function(_Tile){function Air(game){return _classCallCheck(this,Air),_possibleConstructorReturn(this,(Air.__proto__||Object.getPrototypeOf(Air)).call(this,game,{name:"Air",texPosition:[0,0]}))}return _inherits(Air,_Tile),_createClass(Air,[{key:"onCreate",value:function(){this.updateTexture()}},{key:"onNearbyReplace",value:function(){this.updateTexture()}},{key:"updateTexture",value:function(){var topTile=this.game.level.tileAt([this.x,this.y-1]),bottomTile=this.game.level.tileAt([this.x,this.y+1]),bottomLeftTile=(this.game.level.tileAt([this.x-1,this.y]),this.game.level.tileAt([this.x+1,this.y]),this.game.level.tileAt([this.x-1,this.y-1]),this.game.level.tileAt([this.x+1,this.y-1]),this.game.level.tileAt([this.x-1,this.y+1])),bottomRightTile=this.game.level.tileAt([this.x+1,this.y+1]);if("Ground"===bottomTile.name&&"Ground"===bottomLeftTile.name&&"Ground"===bottomRightTile.name){var foliage=(0,_util.rnd)(0,4);if(0===foliage){var what=(0,_util.rnd)(0,4);if(0===what){if(topTile.name!==this.name)return;this.texPosition=[0,1],topTile.texPosition=[1,0]}else this.texPosition=[what,1]}}}}]),Air}(Tile),exports.QuestionBlock=function(_Tile2){function QuestionBlock(game,opts){_classCallCheck(this,QuestionBlock);var _this2=_possibleConstructorReturn(this,(QuestionBlock.__proto__||Object.getPrototypeOf(QuestionBlock)).call(this,game,{name:"? Block",texPosition:[0,4],solid:!0}));return _this2.output=opts.output,_this2}return _inherits(QuestionBlock,_Tile2),_createClass(QuestionBlock,[{key:"onCreate",value:function(){this.i=0,this.punchSound=this.game.sounds.getSound("smw_shell_ricochet")}},{key:"onUpdate",value:function(){this.i+=.1,this.i>=4&&(this.i=0),this.texPosition[0]=Math.max(Math.floor(this.i),0)}},{key:"onAirPunch",value:function(){if(this.punchSound.playNew(),this.game&&this.x&&this.y){var tile=new UsedBlock(this.game),usedBlock=this.game.level.replaceTile([this.x,this.y],tile);if(usedBlock.dy=-.5*Tile.size,this.output){var _game$level$getAbsolu=this.game.level.getAbsolutePosition([this.x,this.y]),_game$level$getAbsolu2=_slicedToArray(_game$level$getAbsolu,2),x=_game$level$getAbsolu2[0],y=_game$level$getAbsolu2[1],out=new this.output(this.game,x,0);out.y=y-out.h-1,out.yv=-1.5,this.game.entities.push(out)}}}}]),QuestionBlock}(Tile),exports.UsedBlock=function(_Tile3){function UsedBlock(game){return _classCallCheck(this,UsedBlock),_possibleConstructorReturn(this,(UsedBlock.__proto__||Object.getPrototypeOf(UsedBlock)).call(this,game,{name:"Used Block",texPosition:[4,4],solid:!0}))}return _inherits(UsedBlock,_Tile3),_createClass(UsedBlock,[{key:"onCreate",value:function(){this.punchSound=this.game.sounds.getSound("smw_shell_ricochet")}},{key:"onAirPunch",value:function(){this.punchSound.playNew()}},{key:"onUpdate",value:function(){this.dy<0?this.dy=Math.ceil(.9*this.dy):this.dy=0}}]),UsedBlock}(Tile))},{"./Entity":12,"./SLW":14,"./util":20}],18:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _SLW=require("./SLW"),_SLW2=_interopRequireDefault(_SLW),_BrowserSLW=require("./BrowserSLW"),_BrowserSLW2=_interopRequireDefault(_BrowserSLW);window.addEventListener("load",function(e){var tileset=new Image;tileset.onload=function(){var game=new _SLW2.default("K",tileset),browser=new _BrowserSLW2.default(game);window.game=game,window.browser=browser,document.body.appendChild(game.canvas),game.tileset=tileset,game.canvas.focus();!function render(){game.gamepadInput(),document.hasFocus()&&(game.player.update(),game.cameraUpdate(),game.level.update(),game.entityUpdate(),game.canvasClear(),game.draw()),requestAnimationFrame(render)}()},tileset.src="tileset.png"})},{"./BrowserSLW":10,"./SLW":14}],19:[function(require,module,exports){module.exports="{\n  K: {\n    id: K\n    name: Kapper Kanyon\n\n    music: kapper-kanyon\n    background: clouds\n\n    special: [\n      world\n    ]\n\n    entities: [\n      [\n        HalfwayFlag\n        2, 2, 1\n      ]\n    ]\n\n    tiles: [\n      [\n        QuestionBlock\n        1, 2, 0\n\n        {\n          output: Coin\n        }\n      ]\n    ]\n\n    width:  100\n    height: 100\n  }\n}\n"},{}],20:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function sign(n){return n>0?1:n<0?-1:0}function rnd(min,max){return Math.floor(Math.random()*max)+min}function arrEqual(arr1,arr2){if(arr1.length!==arr2.length)return!1;for(var i=0;i<arr1.length;i++)if(arr1[i]!==arr2[i])return!1;return!0}function tint(img,colour){var operation=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"source-in",alpha=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,canvas=document.createElement("canvas");canvas.width=img.width,canvas.height=img.height;var ctx=canvas.getContext("2d");if(!ctx)throw new TypeError("Failed to get new canvas context.");ctx.drawImage(img,0,0),ctx.globalCompositeOperation=operation,ctx.globalAlpha=alpha,ctx.fillStyle=colour,ctx.fillRect(0,0,canvas.width,canvas.height);var res=new Image;return res.src=canvas.toDataURL(),res}function crop(img,w,h){var ox=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,oy=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,canvas=document.createElement("canvas");canvas.width=w,canvas.height=h;var ctx=canvas.getContext("2d");if(!ctx)throw new TypeError("Failed to get new canvas context.");ctx.drawImage(img,ox,oy,w,h,0,0,w,h);var res=new Image;return res.src=canvas.toDataURL(),res}function isJump(keys){return keys[90]||keys[32]||isUp(keys)}function isYes(keys){return keys[32]||keys[13]||keys[90]}function isLeft(keys){return keys[65]||keys[37]}function isRight(keys){return keys[68]||keys[39]}function isUp(keys){return keys[87]||keys[38]}function isDown(keys){return keys[83]||keys[40]}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.sign=sign,exports.rnd=rnd,exports.arrEqual=arrEqual,exports.tint=tint,exports.crop=crop,exports.isJump=isJump,exports.isYes=isYes,exports.isLeft=isLeft,exports.isRight=isRight,exports.isUp=isUp,exports.isDown=isDown;var hjson=(exports.EventController=function(){function EventController(){_classCallCheck(this,EventController),this.listeners=new Map}return _createClass(EventController,[{key:"registerEvent",value:function(eventName){this.listeners.set(eventName,[])}},{key:"addEventListener",value:function(eventName,callback){if(!this.listeners.has(eventName))throw new Error("Invalid event name");var eventListeners=this.listeners.get(eventName);eventListeners&&eventListeners.push(callback)}},{key:"dispatchEvent",value:function(eventName){var data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.listeners.has(eventName))throw new Error("Invalid event name");var eventListeners=this.listeners.get(eventName);if(eventListeners){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=eventListeners[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var callback=_step.value;callback(data)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}}}]),EventController}(),require("hjson"));exports.levels=hjson.parse(require("./levels.hjson")),exports.Empty=function Empty(){_classCallCheck(this,Empty)}},{"./levels.hjson":19,hjson:7}]},{},[18]);
//# sourceMappingURL=index.js.map
